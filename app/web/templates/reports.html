{% extends "base.html" %}

{% block title %}Reports - Brooks Trading Coach{% endblock %}

{% block content %}
<div class="space-y-8">
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div>
            <div class="flex items-center gap-3">
                <a href="/settings" class="text-dark-400 hover:text-white transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </a>
                <h1 class="text-3xl font-bold bg-gradient-to-r from-white to-dark-300 bg-clip-text text-transparent">
                    Reports
                </h1>
            </div>
            <p class="text-dark-400 text-sm mt-1 ml-8">Generate premarket and end-of-day reports</p>
        </div>
        <div class="flex flex-wrap gap-3">
            <button onclick="generatePremarket()" class="btn btn-primary">ğŸ“Š Generate Premarket</button>
            <button onclick="generateEOD()" class="btn btn-secondary">ğŸ“‹ Generate EOD</button>
        </div>
    </div>

    <!-- Generate for Ticker -->
    <div class="card">
        <h2 class="text-xl font-bold mb-4 text-white">Generate Premarket Report</h2>
        <div class="flex flex-col sm:flex-row gap-3">
            <select id="ticker-select" class="select flex-1">
                <option value="">All watchlist tickers</option>
                {% for ticker in tickers %}
                <option value="{{ ticker }}">{{ ticker }}</option>
                {% endfor %}
            </select>
            <button onclick="generatePremarketForTicker()" class="btn btn-primary">Generate</button>
        </div>
    </div>

    <!-- Report History -->
    <div class="card">
        <h2 class="text-xl font-bold mb-4 text-white">Report History</h2>
        
        {% if reports %}
        <div class="space-y-3">
            {% for report in reports %}
            <div class="flex items-center justify-between p-4 bg-dark-900/50 border border-dark-700 rounded-xl hover:border-dark-600 transition">
                <div>
                    <div class="font-bold text-white">{{ report.date }}</div>
                    <div class="text-sm">
                        {% if report.has_premarket %}
                            <span class="text-success-400">âœ“ Premarket</span>
                        {% endif %}
                        {% if report.has_eod %}
                            <span class="text-accent-400 ml-2">âœ“ EOD</span>
                        {% endif %}
                    </div>
                </div>
                <div class="text-sm text-dark-500 font-mono">
                    {{ report.path }}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-12">
            <div class="text-4xl mb-4">ğŸ“„</div>
            <p class="text-xl mb-4 text-dark-400">No reports yet</p>
            <button onclick="generatePremarket()" class="btn btn-primary">
                Generate First Report
            </button>
        </div>
        {% endif %}
    </div>

    <!-- Output Folder -->
    <div class="card bg-dark-900/50 border border-dark-700">
        <h3 class="font-medium mb-2 text-white">ğŸ“ Output Location</h3>
        <p class="text-sm text-dark-400">
            Reports are saved to <code class="bg-dark-800 px-2 py-1 rounded text-accent-400">outputs/YYYY-MM-DD/</code>
            as Markdown files. You can open them in any text editor or Markdown viewer.
        </p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function generatePremarket() {
    showStartToast('Generating premarket report');
    try {
        const response = await fetch('/api/generate-premarket', { method: 'POST' });
        const data = await response.json();
        showFinishToast('Premarket report', data.message || 'Generated');
        setTimeout(() => window.location.reload(), 1500);
    } catch (err) {
        showToast('Failed to generate report', 'error');
    }
}

async function generatePremarketForTicker() {
    const ticker = document.getElementById('ticker-select').value;
    showStartToast('Generating report');
    
    const formData = new FormData();
    if (ticker) formData.append('ticker', ticker);
    
    try {
        const response = await fetch('/api/generate-premarket', { 
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        showFinishToast('Report', data.message || 'Generated');
        setTimeout(() => window.location.reload(), 1500);
    } catch (err) {
        showToast('Failed to generate report', 'error');
    }
}

async function generateEOD() {
    showStartToast('Generating EOD report');
    try {
        const response = await fetch('/api/generate-eod', { method: 'POST' });
        const data = await response.json();
        showFinishToast('EOD report', data.message || 'Generated');
        setTimeout(() => window.location.reload(), 1500);
    } catch (err) {
        showToast('Failed to generate report', 'error');
    }
}
</script>
{% endblock %}
