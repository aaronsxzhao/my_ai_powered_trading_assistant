{% extends "base.html" %}

{% block title %}Forgot Password - Brooks Trading Coach{% endblock %}

{% block content %}
<div class="min-h-[80vh] flex items-center justify-center">
    <div class="w-full max-w-md">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="text-5xl mb-4">üîë</div>
            <h1 class="text-3xl font-bold text-white">Forgot Password?</h1>
            <p class="text-dark-400 mt-2">Enter your email to receive a reset link</p>
        </div>
        
        <div class="card">
            {% if sent %}
            <!-- Success State -->
            <div class="text-center py-4">
                <div class="text-4xl mb-4">üìß</div>
                <h2 class="text-xl font-semibold text-white mb-2">Check Your Email</h2>
                <p class="text-dark-400 mb-6">
                    If an account exists with that email, you will receive a password reset link.
                </p>
                <a href="/auth/login" class="btn btn-secondary">
                    Back to Login
                </a>
            </div>
            {% else %}
            <!-- Form -->
            <div id="success-message" class="bg-success-500/20 border border-success-500/30 text-success-400 px-4 py-3 rounded-lg mb-6 hidden"></div>
            <div id="error-message" class="bg-danger-500/20 border border-danger-500/30 text-danger-400 px-4 py-3 rounded-lg mb-6 hidden"></div>
            
            {% if not email_configured %}
            <div class="bg-amber-500/20 border border-amber-500/30 text-amber-400 px-4 py-3 rounded-lg mb-6 text-sm">
                <strong>Note:</strong> Email is not configured. Password reset emails cannot be sent.
            </div>
            {% endif %}
            
            <form id="forgot-form" class="space-y-6">
                <div>
                    <label for="email" class="label">Email Address</label>
                    <input type="email" id="email" name="email" required
                           class="input w-full" placeholder="you@example.com"
                           autocomplete="email">
                </div>
                
                <button type="submit" id="submit-btn" class="btn btn-primary w-full py-3" {% if not email_configured %}disabled{% endif %}>
                    Send Reset Link
                </button>
            </form>
            
            <div class="text-center mt-6">
                <a href="/auth/login" class="text-dark-400 hover:text-white text-sm">
                    ‚Üê Back to Login
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const form = document.getElementById('forgot-form');
if (form) {
    const errorDiv = document.getElementById('error-message');
    const successDiv = document.getElementById('success-message');
    const submitBtn = document.getElementById('submit-btn');
    
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = document.getElementById('email').value.trim();
        
        errorDiv.classList.add('hidden');
        successDiv.classList.add('hidden');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';
        
        try {
            const response = await fetch('/auth/forgot-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email })
            });
            
            const data = await response.json();
            
            successDiv.textContent = data.message || 'Check your email for the reset link.';
            successDiv.classList.remove('hidden');
            form.reset();
        } catch (err) {
            errorDiv.textContent = err.message || 'An error occurred';
            errorDiv.classList.remove('hidden');
        }
        
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Reset Link';
    });
}
</script>
{% endblock %}
